
- name: Update app
  hosts: app
  become: yes
  become_user: root
  vars_files:
    - local_config.yml

  pre_tasks:
    - name: Send Slack notification message on start deployment
      become: false
      slack:
        token: '{{ slack_token }}'
        msg: 'Deployment start on {{ inventory_hostname }}'
        username: fds-bot
        channel: '#fragdenstaat-alerts'
      when: slack_token is defined
      tags:
        - deploy
        - deploy-backend
        - deploy-web
        - deploy-frontend

  roles:
    - app
    - appserver
    - celery
    - nginx

  post_tasks:
    - name: Send Slack notification message on finished deployment
      become: false
      slack:
        token: '{{ slack_token }}'
        msg: 'Deployment finished on {{ inventory_hostname }}'
        username: fds-bot
        channel: '#fragdenstaat-alerts'
      when: slack_token is defined
      tags:
        - deploy
        - deploy-backend
        - deploy-web
        - deploy-frontend
